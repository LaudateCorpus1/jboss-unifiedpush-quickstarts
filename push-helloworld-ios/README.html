<!DOCTYPE html><html><head><title>README</title><link href="http://static.jboss.org/ffe/0/www/vendor/redhat/documentation.css" rel="stylesheet"></link><link href="http://static.jboss.org/ffe/0/www/vendor/redhat/pygments.css" rel="stylesheet"></link></head><body>
<h1><a id="pushhelloworldios-push-helloworld-ios" class="anchor" href="#pushhelloworldios-push-helloworld-ios"><span class="anchor-icon"></span></a>push-helloworld-ios: Push Helloworld iOS</h1>

<p>Author: Corinne Krych (ckrych)<br/>
Level: Beginner<br/>
Technologies: Objective-C, iOS<br/>
Summary: A basic example of Push : Registration and receiving messages.<br/>
Target Product: JBoss Unified Push<br/>
Versions: 1.0<br/>
Source: <a href="https://github.com/jboss-developer/jboss-mobile-quickstarts/">https://github.com/jboss-developer/jboss-mobile-quickstarts/</a>   </p>

<h2><a id="what-is-it" class="anchor" href="#what-is-it"><span class="anchor-icon"></span></a>What is it?</h2>

<p>This quickstart demonstrates how to include basic push functionality in iOS applications using the JBoss Unified Push iOS Push plug-in.</p>

<p>This simple project consists of a ready-to-build iOS application. Before building the application, you must register the iOS variant of the application with a running JBoss Unified Push Server OpenShift instance and Apple Push Notification Service for iOS. The resulting unique IDs and other parameters must then be inserted into the application source code. After this is complete, the application can be built and deployed to iOS devices. </p>

<p>When the application is deployed to an iOS device, the push functionality enables the device to register with the running JBoss Unified Push Server OpenShift instance and receive push notifications.</p>

<h2><a id="how-do-i-run-it" class="anchor" href="#how-do-i-run-it"><span class="anchor-icon"></span></a>How do I run it?</h2>

<h3><a id="0-system-requirements" class="anchor" href="#0-system-requirements"><span class="anchor-icon"></span></a>0. System requirements</h3>

<ul>
<li>iOS 7.X</li>
<li>Xcode version 5.1.X</li>
</ul>

<h3><a id="1-configuration" class="anchor" href="#1-configuration"><span class="anchor-icon"></span></a>1. Configuration</h3>

<h4><a id="creation-of-certificate-signing-request-and-ssl-certificate-for-apns" class="anchor" href="#creation-of-certificate-signing-request-and-ssl-certificate-for-apns"><span class="anchor-icon"></span></a>Creation of Certificate Signing Request and SSL certificate for APNs</h4>

<p>First you need to submit a request for a new digital certificate, which is based on a public/private key. The Certificate itself is acting as the public key, and when you request it, a private key is added to your <code>KeyChain</code> tool. The Cerficate will be used later on, to request an SSL certificate for the <code>Apple Push Network Service</code>, which will allow the JBoss Unified Push Server to send notification messages to it.</p>

<ol>
<li>Request a new CSR (Certificate Signing Request) using <code>KeyChain Access</code> tool found in <code>Applications &gt; Utilities</code> folder on your Mac.  Once opened, in the <code>KeyChain Access</code> menu, choose <code>Certificate Assistant &gt; Request a Certificate from a Certificate Authority</code>. Make sure that you have choosen to store the CSR <em>on file</em>, so we can upload it later in the provisioning portal when requesting the actual SSL cert.</li>
<li>Go to the <a href="https://developer.apple.com/account/overview.action">Provisioning Portal</a> and log in with your Apple developer account. Now, click on the <code>Identifiers</code> link in order to create a new <code>App ID</code> (use the <code>PLUS</code> Icon on the right). In the formular give the <code>App ID</code> a descriptive name. Double check that the <code>Push Notifications</code> checkbox is <em>selected</em>.</li>
<li>Later in the same page you are asked for an <code>Explicit App ID</code>, since the generic <code>Wildcard App ID</code> does not work with Push Notifications. In the <code>Bundle ID</code> field enter <em>YOUR</em> <code>Bundle ID</code>. This is similar to Java packages. <strong>NOTE:</strong> The <code>Bundle ID</code> has to match the one from the actual iOS application that you are building later in this guide.</li>
<li>In the next screen confirm your new <code>App ID</code>, and double check that the <code>Push Notifications</code> option is <em>enabled</em>. Afterwards click the <code>Submit</code> button. In the next screen, click on on the newly created <code>App ID</code>, then click the <code>Edit</code> button and scroll down to the <code>Push Notifications</code> section. Here we are asked to generate a <code>Development</code> and a <code>Production</code> certificate that will be used by the Unified Push Server when contacting the Apple Push Notification service to send messages. If you plan to distribute your app in the App Store, you are required to generate a Production certificate. 

<ul>
<li> <code>Development Certificate</code>: Click the <code>Create Certificate</code> button on the <code>Development SSL Certificate</code> section. Upload the <code>Certificate Signing Request</code> that you created earlier and click the <code>Generate</code> button. The <code>Development SSL Certificate</code> file is being downloaded as <code>aps_development.cer</code>. </li>
<li> <code>Production Certificate</code>: Click the <code>Create Certificate</code> button on the <code>Production SSL Certificate</code> section. Upload the <code>Certificate Signing Request</code> that you created earlier and click the <code>Generate</code> button. The <code>Production SSL Certificate</code> file is being downloaded as <code>aps_production.cer</code>.</li>
</ul></li>
</ol>

<p>You have to export this certificates/private keys pair to the .p12 (Personal Information Exchange). These files will be uploaded later on to the JBoss Unified Push Server enabling it to authorize themselves for your development application on Apple Push Network Service and send messages to them. When exporting the files, as your private keys, you need to assign a passphrase for them. Make note of them, because later when uploading them to the JBoss Unified Push Server you will need both the exported files (<code>aps_development.cer</code>, <code>aps_production.cer</code>) and the passphrases.</p>

<h4><a id="creation-of-a-provisioning-profile" class="anchor" href="#creation-of-a-provisioning-profile"><span class="anchor-icon"></span></a>Creation of a Provisioning Profile</h4>

<p>In order to test Push Notifications you neeed to create a <em>Provisioning Profile</em>.
  *  <code>Development Provisioning Profile</code>: In the <em>Provisioning Portal</em> you need to create an <em>iOS App Development</em> provisioning profile, so that you can test the Push Notifications on your own iOS devices. Select the <code>App ID</code> that you created earlier and your <em>Developer Certificate</em>. Select a <em>Test</em> Device, give it a Profile Name and generate it. Now download the Profile and open the file. Go to <code>Xcode -&gt; preferences...</code> menu, select the <code>Account</code> tab, on the right bottom corner click <code>View details...</code> and you should see your provisioning profile.
  *  <code>Distribution Provisioning Profile</code>: In order to test Push Notifications on a <code>production environment</code>, you need to create an <em>iOS App Distribution</em> provisioning profile in the <em>Provisioning Portal</em>. Select the <code>App ID</code>, that you created earlier and your <em>Production Certificate</em>. You still need a <em>test device</em> to try your <em>production</em> app with your <em>distribution provisioning profile</em>. Select a <em>Test</em> Device, give it a Profile Name and generate it. Now download the Profile and open the file. Go to <code>Xcode -&gt; preferences...</code> menu, select the <code>Account</code> tab, on the right bottom corner click <code>View details...</code> and you should see your provisioning profile.</p>

<h3><a id="2-register-application-with-push-services" class="anchor" href="#2-register-application-with-push-services"><span class="anchor-icon"></span></a>2. Register Application with Push Services</h3>

<p>You must register the application and an iOS variant of the application with the Unified Push Server. This requires a running Unified Push Server OpenShift instance and uses the unique metadata assigned to the application by APNS. For information on installing the Unified Push Server, see the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_JBoss_Unified_Push/">JBoss Unified Push documentation</a>.</p>

<ol>
<li>Log into the Unified Push Server OpenShift instance console.</li>
<li>In the <code>Applications</code> view, click <code>Create Application</code>.</li>
<li>In the <code>Name</code> and <code>Description</code> fields, type values for the application and click <code>Create</code>.</li>
<li>When created, under the application click <code>No variants</code>.</li>
<li>Click <code>Add Variant</code>.</li>
<li>In the <code>Name</code> and <code>Description</code> fields, type values for the iOS application variant.</li>
<li>Click <code>iOS</code> and type the values assigned to the project by APNS (you will have to upload your Developer or Production Certificate)</li>
<li>Click <code>Add</code>.</li>
<li>When created, expand the variant name and make note of the <code>Server URL</code>, <code>Variant ID</code>, and <code>Secret</code>.</li>
</ol>

<h3><a id="3-customize-and-build-application" class="anchor" href="#3-customize-and-build-application"><span class="anchor-icon"></span></a>3. Customize and Build Application</h3>

<p>Replace the bundleId with your bundleId (the one associated with your certificate).
Go to <code>HelloWorld target -&gt; Info</code> and modify the <code>Bundle Identifier</code>:</p>

<p><img src="doc/change-helloworld-bundle.png" alt="change helloworld bundle"/></p>

<p>Now open <strong>HelloWorld.xcodeproj</strong>.</p>

<p>In <code>HelloWorld/AGAppDelegate.m</code> find the pushConfig and change the server url to your JBoss Unified Push Server OpenShift instance and variant/secret:</p>
<div class="highlight"><pre><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didRegisterForRemoteNotificationsWithDeviceToken:</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="p">)</span><span class="nv">deviceToken</span> <span class="p">{</span>
    <span class="c1">// initialize &quot;Registration helper&quot; object using the</span>
    <span class="c1">// base URL where the &quot;JBoss Unified Push Server OpenShift instance&quot; is running.</span>
    <span class="n">AGDeviceRegistration</span> <span class="o">*</span><span class="n">registration</span> <span class="o">=</span>

    <span class="p">[[</span><span class="n">AGDeviceRegistration</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithServerURL</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;&lt;# URL of the running JBoss Unified Push Server OpenShift instance #&gt;&quot;</span><span class="p">]];</span>

    <span class="p">[</span><span class="n">registration</span> <span class="nl">registerWithClientInfo</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">AGClientDeviceInformation</span><span class="o">&gt;</span> <span class="n">clientInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// You need to fill the &#39;Variant Id&#39; together with the &#39;Variant Secret&#39;</span>
        <span class="c1">// both received when performing the variant registration with the server.</span>
        <span class="p">[</span><span class="n">clientInfo</span> <span class="nl">setVariantID</span><span class="p">:</span><span class="s">@&quot;&lt;# Variant Id #&gt;&quot;</span><span class="p">];</span>
        <span class="p">[</span><span class="n">clientInfo</span> <span class="nl">setVariantSecret</span><span class="p">:</span><span class="s">@&quot;&lt;# Variant Secret #&gt;&quot;</span><span class="p">];</span>

        <span class="c1">// if the deviceToken value is nil, no registration will be performed</span>
        <span class="c1">// and the failure callback is being invoked!</span>
        <span class="p">[</span><span class="n">clientInfo</span> <span class="nl">setDeviceToken</span><span class="p">:</span><span class="n">deviceToken</span><span class="p">];</span>

        <span class="c1">// apply the token, to identify THIS device</span>
        <span class="bp">UIDevice</span> <span class="o">*</span><span class="n">currentDevice</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIDevice</span> <span class="n">currentDevice</span><span class="p">];</span>

        <span class="c1">// --optional config--</span>
        <span class="c1">// set some &#39;useful&#39; hardware information params</span>
        <span class="p">[</span><span class="n">clientInfo</span> <span class="nl">setOperatingSystem</span><span class="p">:[</span><span class="n">currentDevice</span> <span class="n">systemName</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">clientInfo</span> <span class="nl">setOsVersion</span><span class="p">:[</span><span class="n">currentDevice</span> <span class="n">systemVersion</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">clientInfo</span> <span class="nl">setDeviceType</span><span class="p">:</span> <span class="p">[</span><span class="n">currentDevice</span> <span class="n">model</span><span class="p">]];</span>


    <span class="p">}</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">()</span> <span class="p">{</span>

        <span class="c1">// Send NSNotification for success_registered, will be handle by registered AGViewController</span>
        <span class="bp">NSNotification</span> <span class="o">*</span><span class="n">notification</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSNotification</span> <span class="nl">notificationWithName</span><span class="p">:</span><span class="s">@&quot;success_registered&quot;</span> <span class="nl">object</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">[[</span><span class="bp">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">postNotification</span><span class="p">:</span><span class="n">notification</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Unified Push registration successful&quot;</span><span class="p">);</span>

    <span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Send NSNotification for error_register, will be handle by registered AGViewController</span>
        <span class="bp">NSNotification</span> <span class="o">*</span><span class="n">notification</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSNotification</span> <span class="nl">notificationWithName</span><span class="p">:</span><span class="s">@&quot;error_register&quot;</span> <span class="nl">object</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">[[</span><span class="bp">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">postNotification</span><span class="p">:</span><span class="n">notification</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Unified Push registration Error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>

    <span class="p">}];</span>
<span class="p">}</span>
</pre></div>
<h3><a id="4-test-the-application" class="anchor" href="#4-test-the-application"><span class="anchor-icon"></span></a>4. Test the Application</h3>

<h4><a id="send-a-push-message" class="anchor" href="#send-a-push-message"><span class="anchor-icon"></span></a>Send a Push Message</h4>

<p>You can send a push notification to your device using the Unified Push Server console by completing the following steps:</p>

<ol>
<li>Log into the Unified Push Server OpenShift instance console.</li>
<li>Click <code>Send Push</code>.</li>
<li>From the <code>Applications</code> list, select the application.</li>
<li>In the <code>Messages</code> field, type the text to be sent as the push notification.</li>
<li>Click <code>Send Push Notification</code>.<br/></li>
</ol>

<p>After a while you will see the message end up on the device.<br/>
When the application is running in foreground, you can catch messages in AGAppDelegate&rsquo;s  <code>application:didReceiveRemoteNotification:</code>. The event is forwarded using <code>NSNotificationCenter</code> for decoupling AGappDelegate and AGViewController. It will be the responsability of AGViewController&rsquo;s <code>messageReceived:</code> method to render the message on UITableView.</p>

<p>When the app is running in background, user can bring the app in the foreground by selecting the Push notification. Therefore AGAppDelegate&rsquo;s  <code>application:didReceiveRemoteNotification:</code> will be triggered and the message displayed on the list. If a background processing was needed we could have used <code>application:didReceiveRemoteNotification:fetchCompletionHandler:</code>. Refer to <a href="https://developer.apple.com/library/ios/documentation/uikit/reference/UIApplicationDelegate_Protocol/Reference/Reference.html#//apple_ref/occ/intfm/UIApplicationDelegate/application:didReceiveRemoteNotification:fetchCompletionHandler:">Apple documentation for more details</a></p>

<p>For application not running, we&rsquo;re using AGAppDelegate&rsquo;s <code>application:didFinishLaunchingWithOptions:</code>, we locally save the latest message and forward the event to AGViewController&rsquo;s <code>messageReceived:</code>.</p>

<p><strong>NOTE</strong>: The local save is required here because of the asynchronous nature of <code>viewDidLoad</code> vs <code>application:didFinishLaunchingWithOptions:</code></p>

<h2><a id="how-does-it-work" class="anchor" href="#how-does-it-work"><span class="anchor-icon"></span></a>How does it work?</h2>

<h3><a id="registration" class="anchor" href="#registration"><span class="anchor-icon"></span></a>Registration</h3>

<p>When the application is launched, AGAppDelegate&rsquo;s <code>application:didFinishLaunchingWithOptions:</code> registers the app to receive remote notifications. </p>
<div class="highlight"><pre><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
<span class="p">{</span>
    <span class="p">[[</span><span class="bp">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">registerForRemoteNotificationTypes</span><span class="p">:</span> 
        <span class="p">(</span><span class="n">UIRemoteNotificationTypeBadge</span> <span class="o">|</span>
         <span class="n">UIRemoteNotificationTypeSound</span> <span class="o">|</span> 
         <span class="n">UIRemoteNotificationTypeAlert</span><span class="p">)];</span>    
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p>Therefore, AGAppDelegate&rsquo;s <code>application:didRegisterForRemoteNotificationsWithDeviceToken:</code> will be called.</p>

<p>When AGAppDelegate&rsquo;s <code>application:didRegisterForRemoteNotificationsWithDeviceToken:</code> is called, the device is registered to Unified Push Server OpenShift instance. This is where configuration changes are required (see code snippet below).</p>

<h2><a id="" class="anchor" href="#"><span class="anchor-icon"></span></a>FAQ</h2>

<ul>
<li><p>Which iOS version is supported by JBoss Unified Push for iOS libraries?</p>

<p>JBoss Unified Push supports iOS 7.0 and later.</p></li>
</ul>

<h1><a id="debug-the-application" class="anchor" href="#debug-the-application"><span class="anchor-icon"></span></a>Debug the Application</h1>

<p>Set a break point in Xcode.</p>
</body></html>
